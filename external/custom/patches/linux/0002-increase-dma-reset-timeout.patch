From: Aaron <aaronsb@gmail.com>
Date: Mon, 25 Nov 2024 10:00:00 +0000
Subject: [PATCH] net: stmmac: dwmac4: use blocking DMA reset for RK3568

Signed-off-by: Aaron <aaronsb@gmail.com>
---
--- a/drivers/net/ethernet/stmicro/stmmac/dwmac4_lib.c	2025-11-25 12:39:11.191812167 -0600
+++ b/drivers/net/ethernet/stmicro/stmmac/dwmac4_lib.c	2025-11-25 12:39:11.945816378 -0600
@@ -15,14 +15,18 @@
 int dwmac4_dma_reset(void __iomem *ioaddr)
 {
 	u32 value = readl(ioaddr + DMA_BUS_MODE);
+	int limit = 20;
 
 	/* DMA SW reset */
 	value |= DMA_BUS_MODE_SFT_RESET;
 	writel(value, ioaddr + DMA_BUS_MODE);
 
-	return readl_poll_timeout(ioaddr + DMA_BUS_MODE, value,
-				 !(value & DMA_BUS_MODE_SFT_RESET),
-				 500, 1000000);
+	while (limit--) {
+		if (!(readl(ioaddr + DMA_BUS_MODE) & DMA_BUS_MODE_SFT_RESET))
+			return 0;
+		mdelay(10);
+	}
+	return -EBUSY;
 }
 
 void dwmac4_set_rx_tail_ptr(void __iomem *ioaddr, u32 tail_ptr, u32 chan)
